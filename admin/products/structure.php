<?php require_once('../../config/config.php');require_once('../patchworks.php');require_once('../products/classes/structure.cls.php');require_once("../attributes/classes/attrgroups.cls.php");require_once("../attributes/classes/attrlabels.cls.php");require_once("../attributes/classes/attrvalues.cls.php");$userAuth = new AuthDAO();$loggedIn = $userAuth->loggedIn($_SESSION['s_log_id']);if ( $loggedIn == 0 ) {    header('location: ../login.php');}$TmpStr = new StrDAO();ini_set('xdebug.max_nesting_level', 4000);$TmpAtr = new AtrDAO();$attrGroups = $TmpAtr->select(NULL, 'PRODUCTGROUP');$productTypeAttr = $TmpAtr->select(NULL, 'PRODUCTTYPE', NULL, NULL, true, NULL, NULL, NULL);?><!doctype html><html lang="en">    <head>        <title>Shop Structure</title>        <?php include('../webparts/headdata.php'); ?>        <!-- colorbox -->        <link rel="stylesheet" href="css/plugins/colorbox/colorbox.css">        <style>            #buildStructure {                min-height: 100px;            }            #buildStructure ul {                /*margin: 0;*/                /*padding: 0;*/                margin-top: 10px;            }            #buildStructure ul li {                /*margin: 0;*/                /*padding: 0;*/                list-style: none;                margin-bottom: 10px;            }            #buildStructure ul li .btn {                display: inline-block;                margin-right: 5px;            }            #subStructure {                margin: 0;                padding: 0;            }            #subStructure li {                margin: 0;                padding: 0;                list-style: none;            }            #subStructure li {                border-bottom: solid 1px #ccc;                padding: 3px 0;                cursor: ns-resize;            }        </style>        <!-- dataTables -->        <script src="website/js/selectnavpreview.js"></script>        <!-- colorbox -->        <script src="js/plugins/colorbox/jquery.colorbox-min.js"></script>        <!-- masonry -->        <script src="js/plugins/masonry/jquery.masonry.min.js"></script>        <!-- imagesloaded -->        <script src="js/plugins/imagesLoaded/jquery.imagesloaded.min.js"></script>        <!-- Plupload -->        <link rel="stylesheet" href="css/plugins/plupload/jquery.plupload.queue.css">        <!-- PLUpload -->        <script src="js/plugins/plupload/plupload.full.js"></script>        <script src="js/plugins/plupload/jquery.plupload.queue.js"></script>    </head>    <?php include('../webparts/navigation.php'); ?>    <body>        <div class="container-fluid" id="content">            <div id="main">                <div class="container-fluid">                    <div class="page-header">                        <div class="pull-left">                            <h1>Structure</h1>                        </div>                        <div class="pull-right">                            <?php include('../webparts/website-left.php'); ?>                        </div>                    </div>                    <div class="breadcrumbs">                        <ul>                            <li>                                <a href="index.php">Dashboard</a>                                <i class="icon-angle-right"></i>                            </li>                            <li>                                <a>Structure</a>                            </li>                        </ul>                    </div>                    <div class="row-fluid">                        <div class="span4">                            <div class="box box-color box-bordered">                                <div class="box-title">                                    <h3><i class="icon-checkbox"></i> Create Main Category</h3>                                    <div class="actions">        <!--								<a href="#" class="btn btn-mini" id="createStructureBtn"><i class="icon-save"></i></a>-->                                        <a href="#" class="btn btn-mini" id="createStructureBtn"><i class="icon-plus-sign"></i></a>                                    </div>                                </div>                                <div class="box-content">                                    <div id="buildStructure"></div>                                </div>                            </div>                        </div>                        <div class="span8">                            <div class="box box-color">                                <div class="box-title">                                    <h3>                                        <i class="icon-reorder"></i>                                        Colored widget                                    </h3>                                    <ul class="tabs">                                        <li class="active">                                            <a href="#t7" data-toggle="tab">Images</a>                                        </li>                                        <li class="">                                            <a href="#t8" data-toggle="tab">Products</a>                                        </li>                                    </ul>                                </div>                                <div class="box-content">                                    <div class="tab-content">                                        <div class="tab-pane active" id="t7">                                            <div class="row-fluid">                                                <div class="span12">                                                    <ul class="gallery gallery-dynamic" id="galleryImages"></ul>                                                </div>                                            </div>                                            <div class="row-fluid">                                                <div class="span12">                                                    <div id="plupload">                                                    </div>                                                </div>                                            </div>                                        </div>                                        <div class="tab-pane" id="t8">                                            <ul id="subStructure"></ul>                                        </div>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>        <div class="modal hide fade" id="structureModal">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h3>Shop Structure</h3>            </div>            <form id="structureModalForm" class="form-horizontal form-bordered form-validate">                <input type="hidden" name="str_id" value="0">                <input type="hidden" name="sta_id" value="0">                <input type="hidden" name="tblnam" value="">                <input type="hidden" name="tbl_id" value="0">                <div class="modal-body" style="padding: 0">                    <div class="control-group">                        <label class="control-label">Parent</label>                        <div class="controls">                            <div id="modalStructure">                            <?php                            $TmpStr->buildStructure(NULL, NULL, 'parentID', 'hide', true);                            ?>                            </div>                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">Name</label>                        <div class="controls">                            <input type="text" class="input-block-level" name="strnam" value="" required>                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">Description</label>                        <div class="controls">                            <input type="text" class="input-block-level customfield"                                   name="strdsc"                                   value="">                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">SEO URL</label>                        <div class="controls">                            <input type="text" class="input-block-level" name="seourl" value="" required>                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">Keywords</label>                        <div class="controls">                            <input type="text" class="input-block-level" name="keywrd" value="">                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">Key Description</label>                        <div class="controls">                            <textarea class="input-block-level" name="keydsc" value=""></textarea>                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">Sort Order</label>                        <div class="controls">                           <input type="text" class="input-block-level" name="srtord" value="" required>                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">Group                            <small>select the product group</small>                        </label>                        <div class="controls">                            <select name="tbl_id">                                <option value="0">N/A</option>                                <?php                                $tableLength = count($attrGroups);                                for ($i = 0; $i < $tableLength; ++$i) {                                    ?>                                    <option value="<?php echo $attrGroups[$i]['atr_id']; ?>"><?php echo $attrGroups[$i]['atrnam']; ?></option>                                <?php } ?>                            </select>                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">From Price</label>                        <div class="controls">                            <input type="text" class="input-block-level customfield"                                   name="frmpri"                                   value="">                        </div>                    </div>                    <div class="control-group hide">                        <label class="control-label">Text before unit price</label>                        <div class="controls">                            <input type="text" class="input-block-level customfield"                                   name="txtBeforeUnitPri"                                   value="">                        </div>                    </div>                    <div class="control-group hide">                        <label class="control-label">Text after unit price</label>                        <div class="controls">                            <input type="text" class="input-block-level customfield"                                   name="txtAfterUnitPri"                                   value="">                        </div>                    </div>                    <div class="control-group">                        <label class="control-label">Cover Image</label>                        <?php                        $val = "";                        ?>                        <div class="controls">                            <?php                            $sql = 'SELECT u.*, g.galnam, g.imgsiz FROM uploads u INNER JOIN gallery g ON g.gal_id = u.tbl_id WHERE u.tblnam = :tblnam ORDER BY g.galnam, srtord ASC';                            $qryArray['tblnam'] = 'WEBGALLERY';                            $galleryImages = $patchworks->run($sql, $qryArray);                            $galleryHTML = '';                            $GalNam = '';                            $tableLength = count($galleryImages);                            for ($i=0;$i<$tableLength;++$i) {                                $check = 'uploads/images/'.$galleryImages[$i]['filnam']==$val?"selected":"";                                $galleryHTML .= '<option '.$check.' value="uploads/images/'.$galleryImages[$i]['filnam'].'">'.$galleryImages[$i]['galnam']." - ".$galleryImages[$i]['uplttl'].'</option>';                            }                            ?>                            <select type="text" class="input-block-level customfield"                                    name="covimg">                                <option value="">Choose an Image</option>                                <?php                                echo $galleryHTML;                                ?>                            </select>                        </div>                    </div>                    <div class="control-group hide">                        <label class="control-label">Colours</label>                        <?php                            $cussiz = $patchworks->getJSONArray($attrGroups[$i]['strobj'], 'cussiz', true);                        ?>                        <div class="controls ">                            <label class="control-label">                                Black                                <input type="checkbox" class="customfield" name="cuscol" value="type0"/>                            </label>                            <label class="control-label">                                Orange                                <input type="checkbox" class="customfield" name="cuscol" value="type1"/>                            </label>                            <label class="control-label">                                Red                                <input type="checkbox" class="customfield" name="cuscol" value="type2"/>                            </label>                            <label class="control-label">                                Blue                                <input type="checkbox" class="customfield" name="cuscol" value="type3"/>                            </label>                            <label class="control-label">                                Green                                <input type="checkbox" class="customfield" name="cuscol" value="type4"/>                            </label>                        </div>                    </div>                    <div class="control-group hide">                        <label class="control-label">Sizes</label>                        <div class="controls">                            <label class="control-label">                                Small                                <input type="checkbox" class="customfield" name="cussiz" value="s"/>                            </label>                            <label class="control-label">                                Medium                                <input type="checkbox" class="customfield" name="cussiz" value="m"/>                            </label>                            <label class="control-label">                                Large                                <input type="checkbox" class="customfield" name="cussiz" value="l"/>                            </label>                            <label class="control-label">                                Extra Large                                <input type="checkbox" class="customfield" name="cussiz" value="xl"/>                            </label>                        </div>                    </div>                </div>                <div class="box" style="display: none;">                    <div class="box-title">                        <h3>                            <i class="icon-comments"></i>                            Language                        </h3>                        <ul class="tabs">                            <li class="active">                                <a href="#french" class="changelanguagelink" data-toggle="tab">French</a>                            </li>                            <li>                                <a href="#german" class="changelanguagelink" data-toggle="tab">German</a>                            </li>                            <li class="">                                <a href="#spanish" class="changelanguagelink" data-toggle="tab">Spanish</a>                            </li>                        </ul>                    </div>                    <div class="box-content nopadding">                        <div class="tab-content">                            <div class="tab-pane active" id="french">                                <div class="control-group">                                    <label class="control-label">French Name</label>                                    <div class="controls">                                        <input type="text" class="input-block-level customfield"                                               name="fr_strnam"                                               value="">                                    </div>                                </div>                            </div>                            <div class="tab-pane" id="german">                                <div class="control-group">                                    <label class="control-label">German Name</label>                                    <div class="controls">                                        <input type="text" class="input-block-level customfield"                                               name="ge_strnam"                                               value="">                                    </div>                                </div>                            </div>                            <div class="tab-pane" id="spanish">                                <div class="control-group">                                    <label class="control-label">Spanish Name</label>                                    <div class="controls">                                        <input type="text" class="input-block-level customfield"                                               name="sp_strnam"                                               value="">                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>                <div class="modal-footer">                    <a href="#" class="btn" data-dismiss="modal"><i class="icon-remove"></i> Cancel</a>                    <button type="submit" class="btn btn-primary" name="action" value="update" id="updateStructureBtn"><i                            class="icon-save"></i> Update                    </button>                </div>            </form>        </div>        <div class="modal hide fade" id="imageModal">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h3>Image Detail</h3>            </div>            <form action="gallery/upload_script.php" id="imageForm" class="form-horizontal" novalidate>                <input type="hidden" name="upl_id" />                <div class="modal-body">                    <fieldset>                        <div class="control-group">                            <label class="control-label">Title</label>                            <div class="controls">                                <input type="text" class="input-block-level" name="uplttl">                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">Description</label>                            <div class="controls">                                <textarea class="input-block-level" name="upldsc"></textarea>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">Link</label>                            <div class="controls">                                <input type="text" class="input-block-level" name="urllnk">                            </div>                        </div>                    </fieldset>                </div>                <div class="modal-footer">                    <a href="#" class="btn" data-dismiss="modal"><i class="icon-remove"></i> Cancel</a>                    <button type="submit" class="btn btn-primary" name="action" value="update" id="updateImageBtn"><i class="icon-save"></i> Update</button>                </div>            </form>        </div>        <script src="products/js/structure.js"></script>    </body></html>